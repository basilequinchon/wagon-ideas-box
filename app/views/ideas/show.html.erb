<div class="selectors">
  <div id="idea-selector" class="selector active">Idea</div>
  <div id="chat-selector" class="selector">Chat</div>
</div>

<div class="container-idea-comments">
  <div class="card-product-show" id="idea-container">
    <% if @idea.photos.attached? %>
      <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <%= cl_image_tag @idea.photos.first.key, class: "d-block w-100 image-caroussel" %>
          </div>
          <% @idea.photos[1..-1].each do |photo| %>
            <div class="carousel-item">
              <%= cl_image_tag photo.key, class: "d-block w-100 image-caroussel" %>
            </div>
          <% end %>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    <% else %>
        <%= image_tag 'https://cdn1.iconfinder.com/data/icons/file-management-system-glyph/32/Filemanager-glyph-svg-83-512.png', alt: 'no-image-attached-to-idea' %>
    <% end %>
    <div class="card-product-infos-show">
      <div class="title-and-upvote">
        <h2><%= @idea.title %> <em>by <%= @idea.user.first_name.capitalize %> <%= @idea.user.last_name.capitalize %></em></h2>
        <div class="votes-in-show" id="votes-in-show">
          <p><%= pluralize(@idea.upvotes.length, 'vote') %></p>
          <% if user_signed_in? && current_user != @idea.user %>
            <% if Upvote.where(idea_id: @idea.id, user: current_user).length > 0 %>
              <p><em>(You upvoted this idea)</em></p>
            <% else %>
              <%= link_to idea_upvotes_path(@idea), remote: true, method: :post do  %>
                <i class="fas fa-arrow-circle-up upvote-arrow"></i>
              <% end %>
            <% end %>
          <% end %>
          <div class="fav-idea" data-fav="<%= @idea.id %>">
            <%= render "shared/add-to-fav", favorite: @idea.favorites.find_by(user: current_user) %>
          </div>
        </div>
      </div>
      <p><%= @idea.description %></p>
      <div class="tag-list d-flex">
        <% @idea.tags.each do |tag| %>
          <div class="tag tag-number<%= rand(1..3) %>">
            <%= tag.name %>
          </div>
        <% end %>
      </div>
    </div>
    <!-- CURRENT USER VIEW -->
    <% if @idea.user == current_user && @idea.team_completed == false %>
      <%= link_to "Team Completed?", "#", data: { confirm: 'Are you sure to CLOSE this idea?' }, class: 'btn btn-primary' %>
      <%= link_to "Delete this idea", idea_path(@idea), data: { confirm: 'Are you sure to DELETE this idea?' }, method: :delete, class: 'btn-ideas-secondary' %>

    <% elsif @idea.user == current_user && @idea.team_completed %>
      <p>The idea is now closed, no more request for participants. Good Luck!</p>

    <!-- OTHER USER VIEW -->
    <% elsif @participant.nil? && @idea.team_completed == false %>
      <%= link_to "Request to Participate", idea_participants_path(@idea), method: :post, class:"btn btn-success mb-3" %>

    <% elsif @participant && @idea.team_completed == false %>
      <p>You requested for participating</p>
      <%= link_to "Remove my request", idea_participant_path(@idea, @participant), method: :delete, data: { confirm: 'Are you sure to DELETE this request?' }, class: 'btn-ideas-secondaryy' %>
    <!-- OTHER USER VIEW AND IDEA IS CLOSED -->
    <% elsif @idea.team_completed %>

      <% if @participant.nil? %>
        <p>The team for this idea has been completed.</p>

      <% else %>
        <% if @participant.participating %>
          <p>The team for this idea has been completed and you are on board!</p>
        <% else %>
          <p>The team for this idea has been completed.</p>
        <% end %>

      <% end %>
    <% end %>

    <div class="card-participations-show mt-5">
      <% if @all_interested_participants.length > 0 %>
        <% @all_interested_participants.each do |participant| %>
            <div class="card-participation">
              <% if participant.user.photo.attached? %>
                <%= cl_image_tag participant.user.photo.key, class: 'avatar' %>
              <% else %>
                <%= image_tag 'profile.png', alt: 'no-image-attached-to-user', class: 'avatar' %>
              <% end %>
              <p><%= participant.user.first_name.capitalize %> <%= participant.user.last_name.capitalize %> is interested to participate</p>
            </div>
        <% end %>
      <% else %>
        <p>No participation request yet</p>
      <% end %>

    </div>
  </div>


  <div class="chatroom hidden" id="chat-container">

      <div class="messages" id="messages-list">
        <% @idea.comments.each do |comment| %>
          <div class="notification">
            <% if comment.user.photo.attached? %>
              <%= cl_image_tag comment.user.photo.key, class: 'avatar-large' %>
            <% else %>
              <%= image_tag 'https://www.outokummunseutu.fi/components/com_easyblog/themes/wireframe/images/placeholder-image.png', alt: 'no-image-attached-to-user', class: 'avatar-large' %>
            <% end %>
            <div class="notification-content">
              <p><strong><%= comment.user.first_name %> <%= comment.user.last_name %></strong></p>
              <p><%= comment.message %></p>
            </div>

            <% if comment.user == current_user %>
              <div class="notification-actions">
                <%= link_to comment_path(comment), data: { confirm: 'Are you sure?' }, method: :delete do %>
                  Delete <i class="far fa-trash-alt"></i>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <div class="comment-zone">
      <%= simple_form_for([@idea, @comment], remote: true) do |f| %>
        <%= f.input :message %>
        <%= f.submit 'Comment now !', class: 'btn-ideas-primary' %>
      <% end %>
    </div>
  </div>
</div>
